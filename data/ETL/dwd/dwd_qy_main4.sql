--转化行政划分编码、根据乡镇街道归属市监管辖
--DROP TABLE IF EXISTS dwd_qy_main4;
--CREATE TABLE dwd_qy_main4 LIKE dwd_qy_main;
INSERT OVERWRITE TABLE dwd_qy_main4
SELECT  t1.pripid    --'主体身份代码'--规上补充过来的会是空
        ,t1.uniscid    --'统一社会信用代码'--市场主体注销的不能补充完整也可能是空
        ,t1.regno    --'注册号'
        ,t1.entname    --'企业名称'
        ,t1.reporttype_cn    --'企业类型名称'
        ,t1.reporttype_code    --'企业类型代码'
        ,t1.industryphy_cn    --'行业门类名称'
        ,t1.industryphy_code    --'行业门类代码'
        ,t1.industryco_cn    --'行业名称'
        ,t1.industryco_code    --'行业代码'
        ,t1.estdate    --'成立日期'
        ,t1.apprdate    --'核准日期'
        ,t1.regcap    --'注册资本'
        ,t1.regcapcur    --'注册资本币种'
        ,t1.dom    --'注册地址'
        ,t1.domdistrict    --'行政区划代码'
        ,t1.dom_street    --'归属乡镇街道'
        ,t1.dom_village    --'归属村居社区'
        ,t1.oploc    --'经营场所'
        ,t1.oplocdistrict    --'经营场所行政区划代码'
        ,t1.oploc_street    --'经营场所乡镇街道'
        ,t1.oploc_village    --'经营场所村居社区'
        ,t1.opfrom    --'经营(驻在)期限自'
        ,t1.opto    --'经营(驻在)期限至'
        ,t1.opscope    --'经营范围'
        ,t1.proloc    --'生产经营地'
        ,t1.proloc_street    --'生产地乡镇街道'
        ,t1.proloc_village    --'生产地村居社区'
        ,t1.yiedistrict    --'生产经营地行政代码'
        ,t1.lerep_name    --'法定代表人'
        ,t1.country_cn    --'国籍名称'
        ,t1.country_code    --'国籍代码'
        ,t1.certype_cn    --'证件类型名称'
        ,t1.certype_code    --'证件类型代码'
        ,t1.cerno    --'身份证件号码'
        ,t1.tel    --'联系电话'
        ,t1.email    --'电子邮件地址'
        ,t1.regstate    --'状态'
        ,t1.revdate    --'吊销时间'
        ,t1.revdecno    --'吊销处罚文号'
        ,t1.revbasis    --'吊销原因'
        ,t1.revauth    --'吊照处罚实施机关'
        ,t1.candate    --'注销时间'
        ,t1.canrea_cn    --'注销原因中文'
        ,t1.canrea_code    --'注销原因代码'
        ,t1.xwstate    --'小微企业状态代码'
        ,t1.xwsort_cn    --'小微企业分类名称'
        ,t1.xw_addtime    --'加入时间'
        ,t1.xw_remtime    --'退出时间'
        ,t1.xw_remreason    --'退出原因'
        ,t1.web_bit    --'互联网监管'
        ,t1.above_bit    --'规上规下'
        ,t1.above_year    --'规上年份'
        ,t1.stock_bit    --'上市企业'
        ,t1.stock_name    --'股票名称'
        ,t1.stock_code    --'股票代码'
        ,t1.stock_date    --'上市时间'
        ,t1.stock_address    --'上市交易所'
        ,t1.stock_text    --'简介描述'
        ,t1.ind_to_ent    --'是否个转企'
        ,t1.ind_to_ent2    --'是否个转企二次转型'
        ,t1.compform    --'个体户组成形式'
        ,t1.regorg    --'企业登记机关'
        ,CASE WHEN t1.localadm IS NOt NULL THEN localadm
         WHEN t1.dom_street IN ('湖岭镇','林川镇','芳庄乡')  THEN '33038102'
         WHEN t1.dom_street='安阳街道'  THEN '33038103'
         WHEN t1.dom_street='玉海街道'  THEN '33038104'
         WHEN t1.dom_street='莘塍街道'  THEN '33038105'
         WHEN t1.dom_street='塘下镇'  THEN '33038106'
         WHEN t1.dom_street IN ('飞云街道','云周街道')  THEN '33038107'
         WHEN t1.dom_street IN ('马屿镇','曹村镇')  THEN '33038108'
         WHEN t1.dom_street IN ('陶山镇','桐浦镇')  THEN '33038109'
         WHEN t1.dom_street IN ('锦湖街道','潘岱街道')  THEN '33038140'
         WHEN t1.dom_street='汀田街道'  THEN '33038141'
         WHEN t1.dom_street='上望街道'  THEN '33038142'
         WHEN t1.dom_street IN ('东山街道','北麂乡')  THEN '33038143'
         WHEN t1.dom_street='南滨街道'  THEN '33038144'
         WHEN t1.dom_street='仙降街道'  THEN '33038145'
         WHEN t1.dom_street IN ('高楼镇','平阳坑镇')  THEN '33038146'
         ELSE '33038100'
         END localadm    --'管辖单位代码'
        ,CASE WHEN t1.localadm_cn IS NOt NULL THEN localadm_cn
         WHEN t1.dom_street IN ('湖岭镇','林川镇','芳庄乡')  THEN '湖岭市监所'
         WHEN t1.dom_street='安阳街道'  THEN '安阳市监所'
         WHEN t1.dom_street='玉海街道'  THEN '玉海市监所'
         WHEN t1.dom_street='莘塍街道'  THEN '莘塍市监所'
         WHEN t1.dom_street='塘下镇'  THEN '塘下市监分局'
         WHEN t1.dom_street IN ('飞云街道','云周街道')  THEN '飞云市监所'
         WHEN t1.dom_street IN ('马屿镇','曹村镇')  THEN '马屿市监所'
         WHEN t1.dom_street IN ('陶山镇','桐浦镇')  THEN '陶山市监所'
         WHEN t1.dom_street IN ('锦湖街道','潘岱街道')  THEN '锦湖市监所'
         WHEN t1.dom_street='汀田街道'  THEN '汀田市监所'
         WHEN t1.dom_street='上望街道'  THEN '上望市监所'
         WHEN t1.dom_street IN ('东山街道','北麂乡')  THEN '东山市监所'
         WHEN t1.dom_street='南滨街道'  THEN '南滨市监所'
         WHEN t1.dom_street='仙降街道'  THEN '仙降市监所'
         WHEN t1.dom_street IN ('高楼镇','平阳坑镇')  THEN '高楼市监所'
         ELSE '瑞安市场监督管理局'
         END localadm_cn    --'管辖单位名称'
        ,t1.laiyuan    --'合表来源'
FROM    (
            SELECT  t1.pripid    --'主体身份代码'--规上补充过来的会是空
                    ,t1.uniscid    --'统一社会信用代码'--市场主体注销的不能补充完整也可能是空
                    ,t1.regno    --'注册号'
                    ,t1.entname    --'企业名称'
                    ,t1.reporttype_cn    --'企业类型名称'
                    ,t1.reporttype_code    --'企业类型代码'
                    ,t1.industryphy_cn    --'行业门类名称'
                    ,t1.industryphy_code    --'行业门类代码'
                    ,t1.industryco_cn    --'行业名称'
                    ,t1.industryco_code    --'行业代码'
                    ,t1.estdate    --'成立日期'
                    ,t1.apprdate    --'核准日期'
                    ,t1.regcap    --'注册资本'
                    ,t1.regcapcur    --'注册资本币种'
                    ,DzCjBq(t1.dom,t1.dom_street,t1.dom_village) dom    --'注册地址'
                    ,d1.cs_code AS domdistrict    --'行政区划代码'
                    ,t1.dom_street    --'归属乡镇街道'
                    ,t1.dom_village    --'归属村居社区'
                    ,DzCjBq(t1.oploc,t1.oploc_street,t1.oploc_village) oploc    --'经营场所'
                    ,d2.cs_code AS oplocdistrict    --'经营场所行政区划代码'
                    ,t1.oploc_street    --'经营场所乡镇街道'
                    ,t1.oploc_village    --'经营场所村居社区'
                    ,t1.opfrom    --'经营(驻在)期限自'
                    ,t1.opto    --'经营(驻在)期限至'
                    ,t1.opscope    --'经营范围'
                    ,DzCjBq(t1.proloc,t1.proloc_street,t1.proloc_village) proloc    --'生产经营地'
                    ,t1.proloc_street    --'生产地乡镇街道'
                    ,t1.proloc_village    --'生产地村居社区'
                    ,d2.cs_code AS yiedistrict    --'生产经营地行政代码'
                    ,t1.lerep_name    --'法定代表人'
                    ,t1.country_cn    --'国籍名称'
                    ,t1.country_code    --'国籍代码'
                    ,t1.certype_cn    --'证件类型名称'
                    ,t1.certype_code    --'证件类型代码'
                    ,t1.cerno    --'身份证件号码'
                    ,t1.tel    --'联系电话'
                    ,t1.email    --'电子邮件地址'
                    ,t1.regstate    --'状态'
                    ,t1.revdate    --'吊销时间'
                    ,t1.revdecno    --'吊销处罚文号'
                    ,t1.revbasis    --'吊销原因'
                    ,t1.revauth    --'吊照处罚实施机关'
                    ,t1.candate    --'注销时间'
                    ,t1.canrea_cn    --'注销原因中文'
                    ,t1.canrea_code    --'注销原因代码'
                    ,t1.xwstate    --'小微企业状态代码'
                    ,t1.xwsort_cn    --'小微企业分类名称'
                    ,t1.xw_addtime    --'加入时间'
                    ,t1.xw_remtime    --'退出时间'
                    ,t1.xw_remreason    --'退出原因'
                    ,t1.web_bit    --'互联网监管'
                    ,t1.above_bit    --'规上规下'
                    ,t1.above_year    --'规上年份'
                    ,t1.stock_bit    --'上市企业'
                    ,t1.stock_name    --'股票名称'
                    ,t1.stock_code    --'股票代码'
                    ,t1.stock_date    --'上市时间'
                    ,t1.stock_address    --'上市交易所'
                    ,t1.stock_text    --'简介描述'
                    ,t1.ind_to_ent    --'是否个转企'
                    ,t1.ind_to_ent2    --'是否个转企二次转型'
                    ,t1.compform    --'个体户组成形式'
                    ,t1.regorg    --'企业登记机关'
                    ,t1.localadm    --'管辖单位代码'
                    ,t1.localadm_cn    --'管辖单位名称'
                    ,t1.laiyuan    --'合表来源'
            FROM    dwd_qy_main3 t1    --企业底数
            LEFT JOIN dict_area_code d1 ON d1.cs_name=t1.dom_village AND d1.zj_name=t1.dom_street 
            LEFT JOIN dict_area_code d2 ON d2.cs_name=t1.oploc_village AND d2.zj_name=t1.oploc_street 
            LEFT JOIN dict_area_code d3 ON d3.cs_name=t1.proloc_village AND d3.zj_name=t1.proloc_street 
        ) t1     
;